import React, { useContext, useEffect, useState } from 'react'
import { Redirect, Route } from 'react-router-dom'
import { IonApp, IonIcon, IonLabel, IonRouterOutlet, IonTabBar, IonTabButton, IonTabs } from '@ionic/react'
import { IonReactRouter } from '@ionic/react-router'

import { ellipse, square, triangle } from 'ionicons/icons'
import CameraTab from './pages/CameraTab'
import FacesPage from './pages/Faces'
import ResultsPage from './pages/Results'
import Tab2 from './pages/Tab2'
import Tab3 from './pages/Tab3'

import { AnimatePresence } from 'framer-motion'

/* Core CSS required for Ionic components to work properly */
import '@ionic/react/css/core.css'

/* Basic CSS for apps built with Ionic */
import '@ionic/react/css/normalize.css'
import '@ionic/react/css/structure.css'
import '@ionic/react/css/typography.css'

/* Optional CSS utils that can be commented out */
import '@ionic/react/css/padding.css'
import '@ionic/react/css/float-elements.css'
import '@ionic/react/css/text-alignment.css'
import '@ionic/react/css/text-transformation.css'
import '@ionic/react/css/flex-utils.css'
import '@ionic/react/css/display.css'

/* Theme variables */
import './theme/variables.css'

import { File } from '@ionic-native/file'

// import './tabs.scss'

import { AppContext } from './State'

const MainApp = (props) => {
  const { state, dispatch } = useContext(AppContext)

  useEffect(() => {
    const people = `{
      "data": [
          {
              "name": "Donald Trump",
              "descriptor": {"0":-0.09906005859375,"1":0.1451416015625,"2":-0.0163269080221653,"3":0.020538335666060448,"4":-0.0631103590130806,"5":-0.00448227021843195,"6":0.054962173104286194,"7":-0.1716308742761612,"8":0.1424560546875,"9":-0.09912109375,"10":0.1568603664636612,"11":-0.00897979736328125,"12":-0.332275390625,"13":-0.08636474609375,"14":0.02194214053452015,"15":0.1258545070886612,"16":-0.1853027492761612,"17":-0.1245117262005806,"18":-0.1690673977136612,"19":-0.1499023586511612,"20":0.0450744703412056,"21":0.0256958045065403,"22":-0.044708251953125,"23":-0.009880066849291325,"24":-0.1239624097943306,"25":-0.2042236179113388,"26":-0.0620422437787056,"27":-0.0315551832318306,"28":0.01617431640625,"29":-0.0753173828125,"30":0.0357666052877903,"31":0.042633056640625,"32":-0.2491455078125,"33":-0.1096801906824112,"34":-0.02153015322983265,"35":0.0535888671875,"36":-0.0320739783346653,"37":-0.0355224646627903,"38":0.1061401441693306,"39":0.02874756045639515,"40":-0.1124267578125,"41":0.0345153883099556,"42":0.018157958984375,"43":0.2285156548023224,"44":0.2133789211511612,"45":-0.00448227021843195,"46":-0.0449523963034153,"47":-0.1585693508386612,"48":0.1396484375,"49":-0.2413330078125,"50":-0.0023918161168694496,"51":0.158935546875,"52":0.1298828274011612,"53":0.1440429836511612,"54":0.0316772498190403,"55":-0.138916015625,"56":0.014984133653342724,"57":0.1052246019244194,"58":-0.1405029296875,"59":0.0652465894818306,"60":0.013549805618822575,"61":-0.2099609673023224,"62":-0.01028442569077015,"63":-0.060913100838661194,"64":0.051910411566495895,"65":0.0227813757956028,"66":0.0005288124084472656,"67":-0.1473388671875,"68":0.2138672024011612,"69":-0.1575927734375,"70":-0.162841796875,"71":0.02099609375,"72":-0.034240733832120895,"73":-0.1708984524011612,"74":-0.381591796875,"75":0.0353393591940403,"76":0.332275390625,"77":0.179931640625,"78":-0.2304687798023224,"79":0.010589602403342724,"80":-0.0827026441693306,"81":-0.05242919921875,"82":0.0673828125,"83":0.1007080078125,"84":0.006172180641442537,"85":-0.0931396558880806,"86":-0.1141357421875,"87":0.0388793982565403,"88":0.245361328125,"89":-0.0835571363568306,"90":-0.03790283203125,"91":0.2626953125,"92":0.0314941480755806,"93":0,"94":0.0399169959127903,"95":0.043853759765625,"96":-0.1390380859375,"97":-0.00858306884765625,"98":-0.1423339992761612,"99":-0.1129150465130806,"100":0.06768798828125,"101":-0.10479736328125,"102":-0.00009179121116176248,"103":0.1151123046875,"104":-0.1491699367761612,"105":0.2052002102136612,"106":0.0262298621237278,"107":-0.023498542606830597,"108":-0.0314025953412056,"109":-0.0927734449505806,"110":-0.0241851806640625,"111":0.041015636175870895,"112":0.1647949367761612,"113":-0.1759033501148224,"114":0.2763671875,"115":0.2199707180261612,"116":-0.048156749457120895,"117":0.1534423828125,"118":0.026275642216205597,"119":0.0975952222943306,"120":-0.0365905836224556,"121":-0.0504150465130806,"122":-0.1429443508386612,"123":-0.1499023586511612,"124":0.039093017578125,"125":0.0376892164349556,"126":-0.012619021348655224,"127":0.049041759222745895}
          },
          {
              "name": "Barrack Obama",
              "descriptor": {"0":-0.09063720703125,"1":0.1212158352136612,"2":0.015350344590842724,"3":-0.0919799879193306,"4":0.008934023790061474,"5":0.01263427920639515,"6":-0.07232666015625,"7":-0.0789794921875,"8":0.1929931789636612,"9":-0.10736083984375,"10":0.2435302585363388,"11":0.1055297926068306,"12":-0.2257080078125,"13":-0.1571044921875,"14":0.0535583570599556,"15":0.1268310695886612,"16":-0.1967773586511612,"17":-0.0908813625574112,"18":-0.1475830078125,"19":-0.1472167819738388,"20":0.010482790879905224,"21":0.004074097145348787,"22":0.0911865308880806,"23":0.0504455640912056,"24":-0.16162109375,"25":-0.3486328125,"26":-0.0570373609662056,"27":-0.178466796875,"28":-0.028854375705122948,"29":-0.132568359375,"30":-0.0637817457318306,"31":-0.02110290713608265,"32":-0.172607421875,"33":-0.1150512769818306,"34":0.02725219912827015,"35":-0.01602173037827015,"36":0.016372686251997948,"37":0.0107421875,"38":0.1944580078125,"39":0.0455017127096653,"40":-0.1078491359949112,"41":0.0825805738568306,"42":0.0164032019674778,"43":0.2583008110523224,"44":0.2705078125,"45":0.084228515625,"46":0.0161285400390625,"47":-0.08172607421875,"48":0.1352539211511612,"49":-0.2449951320886612,"50":0.07366943359375,"51":0.1412353515625,"52":0.02442932315170765,"53":0.026702886447310448,"54":0.124755859375,"55":-0.1782226860523224,"56":-0.020065313205122948,"57":0.1297607570886612,"58":-0.1339111328125,"59":0.039978038519620895,"60":0.0029811870772391558,"61":-0.0902710035443306,"62":-0.0753173828125,"63":0.025024421513080597,"64":0.205078125,"65":0.1251220852136612,"66":-0.1429443508386612,"67":-0.07879638671875,"68":0.1538086086511612,"69":-0.0266876220703125,"70":0.0023918161168694496,"71":0.008804322220385075,"72":-0.179931640625,"73":-0.1845703274011612,"74":-0.2607421875,"75":0.0859375,"76":0.388671875,"77":0.1812744140625,"78":-0.2169189453125,"79":-0.005882263649255037,"80":-0.1866455078125,"81":0.0486450158059597,"82":0.0972900316119194,"83":0.03099060244858265,"84":-0.06640625,"85":-0.1007690504193306,"86":-0.0346679724752903,"87":0.07098388671875,"88":0.0854492262005806,"89":0.0636596754193306,"90":-0.047485362738370895,"91":0.2274170219898224,"92":-0.023544317111372948,"93":0.0535583570599556,"94":0.0259704627096653,"95":0.0638427808880806,"96":-0.1798095852136612,"97":-0.029632577672600746,"98":-0.1945800632238388,"99":-0.0503845252096653,"100":0.0370788611471653,"101":-0.004344940185546875,"102":0.0493164137005806,"103":0.1459961086511612,"104":-0.1949462890625,"105":0.07122802734375,"106":0.005920411087572575,"107":-0.0365600623190403,"108":-0.0009312632028013468,"109":0.06640625,"110":-0.0350036695599556,"111":-0.040924083441495895,"112":0.06707763671875,"113":-0.2380371391773224,"114":0.2308349609375,"115":0.2551269829273224,"116":0.0252685584127903,"117":0.1612548977136612,"118":0.0792236328125,"119":-0.0009512904216535389,"120":-0.005363465752452612,"121":-0.023498542606830597,"122":-0.1824951320886612,"123":-0.0501709058880806,"124":0.0392150916159153,"125":0.0549926795065403,"126":0.07415771484375,"127":-0.013305666856467724}
          },
          {
              "name": "Baby Bryce",
              "descriptor": {"0":-0.0667724609375,"1":0.0294494666159153,"2":0.01866150088608265,"3":-0.11090087890625,"4":-0.06951904296875,"5":-0.0326232984662056,"6":0.0003850461507681757,"7":-0.0500183142721653,"8":0.1436767578125,"9":-0.1451416015625,"10":0.18896484375,"11":-0.0404663123190403,"12":-0.1562500149011612,"13":0.0302734412252903,"14":-0.0886230543255806,"15":0.1278076320886612,"16":-0.2314453274011612,"17":-0.1172485426068306,"18":-0.0722045972943306,"19":-0.0250549353659153,"20":-0.009254458360373974,"21":0.10198974609375,"22":-0.0767822265625,"23":0.1374511867761612,"24":-0.1715087890625,"25":-0.2734375,"26":-0.1105957105755806,"27":-0.134765625,"28":-0.005744934547692537,"29":-0.0880126953125,"30":0.002971650566905737,"31":0.1016235426068306,"32":-0.1367187649011612,"33":0.003223419887945056,"34":0.0555114783346653,"35":0.03619384765625,"36":-0.013549805618822575,"37":-0.07977294921875,"38":0.2076416015625,"39":0.0763549879193306,"40":-0.1842041164636612,"41":-0.0214233435690403,"42":0.088134765625,"43":0.351318359375,"44":0.1483154296875,"45":0.0346679724752903,"46":-0.03106689453125,"47":-0.0168151892721653,"48":0.1975097805261612,"49":-0.2487793266773224,"50":-0.0441589392721653,"51":0.1337890774011612,"52":0.124267578125,"53":0.0641479566693306,"54":0.07598876953125,"55":-0.07061767578125,"56":0.0747680738568306,"57":0.0825195387005806,"58":-0.230712890625,"59":0.055389415472745895,"60":-0.025436406955122948,"61":-0.1185913234949112,"62":0.054840102791786194,"63":-0.07745361328125,"64":0.2177734524011612,"65":0.0149917621165514,"66":-0.1297607570886612,"67":-0.0668945387005806,"68":0.2141113132238388,"69":-0.2105713188648224,"70":-0.0770263671875,"71":0.0649414137005806,"72":-0.0704345777630806,"73":-0.1779785305261612,"74":-0.2369384914636612,"75":-0.0405273474752903,"76":0.380126953125,"77":0.1660156548023224,"78":-0.0845336988568306,"79":0.1231689602136612,"80":-0.051116954535245895,"81":-0.1278076320886612,"82":0.040832530707120895,"83":0.1203003004193306,"84":-0.050567626953125,"85":0.01094818115234375,"86":-0.0085678119212389,"87":0.0433349646627903,"88":0.302978515625,"89":-0.006652833428233862,"90":0.0402526929974556,"91":0.2148437798023224,"92":-0.053985610604286194,"93":-0.041931163519620895,"94":0.02297973819077015,"95":-0.0299530066549778,"96":-0.09503173828125,"97":0.012100222520530224,"98":-0.0223388671875,"99":0.10565185546875,"100":-0.01698303036391735,"101":-0.11444091796875,"102":-0.002292633056640625,"103":0.1036377102136612,"104":-0.2436523586511612,"105":0.1405029296875,"106":-0.00877380557358265,"107":-0.07049560546875,"108":-0.003347398480400443,"109":0.0398559607565403,"110":-0.1489257961511612,"111":-0.041107188910245895,"112":0.1770019680261612,"113":-0.304931640625,"114":0.1606445461511612,"115":0.13818359375,"116":-0.001983643276616931,"117":0.1155395656824112,"118":-0.007400513626635075,"119":0.02047729678452015,"120":-0.0349731519818306,"121":-0.055145263671875,"122":-0.1834716945886612,"123":-0.142578125,"124":0.1176147609949112,"125":-0.1110839918255806,"126":0.0651855543255806,"127":-0.0309753455221653}
          }
      ]
  }`
    console.log('Wrote file')
    File.writeExistingFile(File.dataDirectory, 'missing_persons.json', people)
  }, [])

  return (
    <IonTabs>
      <IonRouterOutlet>
        <AnimatePresence exitBeforeEnter>
          <Route path='/main/:tab(camera)' component={CameraTab} exact />
          <Route path='/main/:tab(camera)/faces' component={FacesPage} exact />
          <Route path='/main/:tab(camera)/results' component={ResultsPage} exact />
          <Route path='/' render={() => <Redirect to='/main/:tab(camera)' />} exact />
        </AnimatePresence>
      </IonRouterOutlet>

      <IonTabBar slot='bottom' className='tabs'>
        <IonTabButton tab='home' href='/main/camera'>
          <IonIcon icon={ellipse} />
        </IonTabButton>
        <IonTabButton tab='repository' href='/main/upload'>
          <IonIcon icon={triangle} />
        </IonTabButton>
      </IonTabBar>
    </IonTabs>
  )
}

export default MainApp
